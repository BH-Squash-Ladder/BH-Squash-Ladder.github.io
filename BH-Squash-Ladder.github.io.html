<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Squash Ladder</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
</head>
<body class="bg-slate-50 p-6">
  <div id="root"></div>

  <script type="text/javascript">
    const { useState, useEffect } = React;

    const SAMPLE_PLAYERS = [
      { id: "p1", name: "Alice" },
      { id: "p2", name: "Ben" },
      { id: "p3", name: "Carl" },
      { id: "p4", name: "Diane" },
      { id: "p5", name: "Eve" },
    ];

    const STORAGE_KEY = "squash_ladder_v1";
    const REQUESTS_KEY = "squash_requests_v1";

    function App() {
      const [players, setPlayers] = useState(() => loadPlayers());
      const [requests, setRequests] = useState(() => loadRequests());
      const [showRequestModal, setShowRequestModal] = useState(false);
      const [selectedChallenger, setSelectedChallenger] = useState("");
      const [selectedTarget, setSelectedTarget] = useState("");
      const [notes, setNotes] = useState("");
      const [isAdmin, setIsAdmin] = useState(false);
      const [adminPass, setAdminPass] = useState("");
      const [filter, setFilter] = useState("");

      useEffect(() => savePlayers(players), [players]);
      useEffect(() => saveRequests(requests), [requests]);

      function loadPlayers() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (raw) return JSON.parse(raw);
        } catch (e) {}
        return SAMPLE_PLAYERS;
      }

      function savePlayers(list) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      }

      function loadRequests() {
        try {
          const raw = localStorage.getItem(REQUESTS_KEY);
          if (raw) return JSON.parse(raw);
        } catch (e) {}
        return [];
      }

      function saveRequests(list) {
        localStorage.setItem(REQUESTS_KEY, JSON.stringify(list));
      }

      function openRequestModal() {
        setSelectedChallenger(players[0]?.id || "");
        setSelectedTarget(players[1]?.id || "");
        setNotes("");
        setShowRequestModal(true);
      }

      function submitRequest(e) {
        e.preventDefault();
        if (!selectedChallenger || !selectedTarget || selectedChallenger === selectedTarget) return;
        const request = {
          id: `r_${Date.now()}`,
          challenger: selectedChallenger,
          target: selectedTarget,
          notes,
          createdAt: new Date().toISOString(),
          status: "pending",
        };
        setRequests((r) => [request, ...r]);
        setShowRequestModal(false);
      }

      function approveRequest(id) {
        const req = requests.find((r) => r.id === id);
        if (!req) return;
        setPlayers((list) => {
          const challengerIndex = list.findIndex((p) => p.id === req.challenger);
          const targetIndex = list.findIndex((p) => p.id === req.target);
          if (challengerIndex === -1 || targetIndex === -1) return list;
          const newList = list.slice();
          const [challenger] = newList.splice(challengerIndex, 1);
          newList.splice(targetIndex, 0, challenger);
          return newList;
        });
        setRequests((rs) => rs.map((r) => (r.id === id ? { ...r, status: "approved", decidedAt: new Date().toISOString() } : r)));
      }

      function rejectRequest(id) {
        setRequests((rs) => rs.map((r) => (r.id === id ? { ...r, status: "rejected", decidedAt: new Date().toISOString() } : r)));
      }

      function addPlayer(name) {
        const id = `p_${Date.now()}`;
        setPlayers((p) => [...p, { id, name }]);
      }

      function removePlayer(id) {
        if (!confirm("Remove player?")) return;
        setPlayers((p) => p.filter((x) => x.id !== id));
        setRequests((rs) => rs.filter((r) => r.challenger !== id && r.target !== id));
      }

      function toggleAdmin() {
        if (adminPass === "admin123") {
          setIsAdmin((s) => !s);
          setAdminPass("");
        } else alert("Wrong admin password (demo: admin123)");
      }

      const visiblePlayers = players.filter((p) => p.name.toLowerCase().includes(filter.toLowerCase()));

      return (
        React.createElement("div", { className: "max-w-5xl mx-auto" },
          React.createElement("h
